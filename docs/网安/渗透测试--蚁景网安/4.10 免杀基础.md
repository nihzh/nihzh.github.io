Anti Anti-virus 反杀毒软件
- 反汇编
- 逆向工程
- 系统漏洞
- 修改病毒, 木马的内容, 改变特征码, 避免查杀
调用API

### 杀软检测技术
- 签名检测: 恶意文件标签黑名单
- 静态程序分析: 针对特定版本源代码, runtime以外分析
- 动态程序分析: 测试目标程序的行为, 在虚拟处理器执行
- 沙盒分析
- 启发式分析: 对潜在的恶意软件进行各种维度的风险衡量, *MCA多标准分析*
- 信息熵检测: 每个软件都被描述成数值性质的属性(信息熵)或抽象性质的属性, 找到最合适的量度来验证和对比

针对有反杀机制的恶意软件的检测
- 混淆检测: payload + obfuscator
- 加壳检测: 将可执行文件压缩, 与解压缩代码合并成一个可执行文件. 执行时会重新创建原始代码
- 加密检测: 对二进制加密以免逆向分析, 使用*RunPE*, 将代码挂起以执行干净的进程, 然后修改内存代码为恶意代码

### 常见免杀方式
- 特征码免杀
- 花指令免杀
- 加壳免杀
- 分离免杀: 将shellcode 和shellcode loader加载器分离
- 资源修改: 针对杀软白名单定制软件特征
	- 加资源
	- 替换资源(version等)
	- 加签名

https://github.com/TideSec/BypassAntiVirus
https://github.com/matro7sh/BypassAV

### shellcode
一段用于利用软件漏洞而执行的代码, 一般为16进制机器码

### shellcodeLoader
将shellcode加载到内存执行, 不同语言的loader写法不同

开辟一片可读可写可执行的内存, 载入shellcode, 然后跳转到shellcode首地址以执行

## 免杀测试环境
- Windows原生纯净镜像下载: https://msdn.itellyou.cn
	- 激活密钥: W269N-WFGWX-YVC9B-4J6C9-T83GX
- 火绒
- 360安全卫士
- 360安全卫士极速版
- tdm-gcc: https://jmeubank.github.io/tdm-gcc/download/
- mingw-w64: https://www.mingw-w64.org/downloads/ 
- Visual Studio

大部分脚本语言加载shellcode 都是通过c的`FFI(Foreign Funciton Interface)`来调用操作系统的api

Python内存加载原理: Ctypes
https://docs.python.org/zh-cn/3.7/library/ctypes.html
与c兼容的数据类型, 并允许调用DLL或共享库中的函数

载入动态连接库: 导出cdll对象, 在Windows中windll和oledll对象用于载入动态连接库


