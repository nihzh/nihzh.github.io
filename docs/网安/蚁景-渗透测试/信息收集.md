## 什么是信息收集
信息收集是指通过各种方式获取所需要的信息, 方便后续渗透过程的进行. 比如目标站点IP, 中间件, 脚本语言, 端口, 邮箱等等. **信息收集包含资产收集但不限于资产收集**, 为了更多的暴露面和更大的可能性.

## 信息收集分类
- *主动信息收集*: 通过直接访问网站和在网站上进行操作, 对网站进行扫描等. 此种方法**有网络流量经过目标服务器**
- *被动信息收集*: 基于公开的渠道如搜索引擎, 在不与目标胸痛直接交互的情况下获取信息. 尽量避免留下痕迹.

## 收集哪些信息
- *域名信息* (whois, 备案信息, 子域名)
- *服务器信息* (端口, 服务, 真实IP)
- *网站信息* (网站架构, 操作系统, 中间件, 数据库, 编程语言, 指纹信息, WAF, 敏感目录, 敏感文件, 源码泄露, 旁站, C段)
- *管理员信息* (姓名, 职务, 生日, 联系电话, 邮件地址)

### 域名信息收集
域名 (Domain Name, 网域), 是由遗传用点分隔的名字组成的Internet上某一台计算机或计算机组的名称, 用于在数据传输时标识计算机的**逻辑位置**.

DNS (Domain Name System, 域名系统). 用来将*域名*和*IP地址*相互映射的一个分布式数据库

#### 域名分类
- 顶级域名 `.com`  `.gov`  `.edu`
- 二级域名 `baidu.com`
- 三级域名 `www.baidu.com`

#### Whois协议
是用来查询域名的IP以及所有者等信息的传输协议. whois就是一个用来查询域名是否已经被注册, 以及注册域名的详细信息的数据库 (如域名所有人, 域名注册商, 域名注册日期和过期日期等)
##### web接口查询
- https://whois.aliyun.com
- https://www.whois365.com/cn/
- http://whois.chanaz.com
##### 命令行查询
`whois baidu.com`
##### python脚本查询
```python
import whois

domain = input("Input the domain: ")
data = whois.whois(domain)
print("domain: %s" % data['domain_name'])
print("emails: %s" % data['emails'])
print("organisation: %s" % data['org'])
print("creation time: %s" % data['creation_time']
print("update time: %s" % data['updated_time'])
```

#### 备案信息
查询网站是否合法经营, 可以通过备案号反查该公司旗下的资产
- https://beian.miit.gov.cn
- http://www.beian.gov.cn/portal/registerSystemInfo
- http://icp.chanaz.com
- https://icplishi.com

#### Whois反查
通过注册人, 注册人邮箱, 注册人手机号等信息反查whois信息
很多公司网站都是DNS解析的运营商注册的, 查到的是云因伤代替个人何公司注册的网站信息
- https://whois.chinaz.com/reverse?ddlSearchMode=1
- http://whois.4.cn/reverse
- https://whois.aizhan.com

#### 子域名
子域名指二级域名, `baidu.com`是顶级域名`.com`的子域
##### Google Hacking
`site:baidu.com`
##### Python脚本
##### 第三方web接口
- https://dnsdumpster.com
- https://www.dnsgrep.cn
- https://developers.virustotal.com/reference/domains-relationships
- http://tool.chinaz.com/subdomain
- https://phpinfo.me/domain
- https://www.nmmapper.com/sys/tools/subdomainfinder
##### 网络空间安全搜索引擎
- https://fofa.info
- https://www.zoomeye.org
- https://hunter.qianxin.com
- https://www.shodan.io

#### SSL证书查询
- https://crt.sh
- https://developers.facebook.com/tools/ct/search

#### JS文件发现子域名
- https://github.com/Threezh1/JSFinder

#### 子域名收集工具
1. 子域名挖掘机
2. OneForAll https://github.com/shmilylty/OneForAll
3. Subdomainsbrute 高并发DNS暴力枚举工具 https://github.com/lijiejie/subDomainBrute
4. Sublist3r https://github.com/aboul3la/Sublist3r
5. ESD https://github.com/FeeiCn/ESD
6. dnsbrute https://github.com/Q2h1Cg/dnsbrute
7. Anubis https://github.com/jonluca/Anubis
8. subdomain3 https://github.com/yanxiu0614/subdomain3
9. teemo https://github.com/bit4woo/teemo
10. Sudomy https://github.com/screetsec/Sudomy
11. ARL https://github.com/TophantTehnology/ARL
12. SubFinder + KSubdomain + HttpX
	- **SubFinder**: 子域名信息查询工具, 使用国外安全网站的api自动化搜索
		- https://github.com/projectdiscovery/subfinder
	- **HttpX**: 运行速度极快的HTTP安全工具, 使用retryablehttp库和多线程机制
		- https://github.com/projectdiscovery/httpx
	- **ksubdomain**: 全平台无状态子域名DNS爆破工具, mac和win理论最快发包速度30w/s, linux160w/s
		- https://github.com/knownsec/ksubdomain
```linux
# 管道操作, 收集域名,验证域名,http验证存活
./subfinder -d baidu.com -silent|./ksubdomain -verify -silent|./https -title -content-length -status-code
```

### IP 端口信息收集
#### IP信息收集
##### IP反查域名
- http://stool.chinaz.com/same
- https://tools.ipip.net/ipdomain.php
- https://www.dnsgrip.cn
- https://site.ip138.com/
如果渗透目标为虚拟主机, 那么通过IP反查到的域名信息就很有价值. 一台物理服务器上可能运行多个虚拟主机. 这些虚拟主机有不同的域名, 但通常共用一个IP地址. 如果直到哪些网站共用这台服务器, 就有可能通过此台服务器上的其他网站的漏洞获取服务器控制权, 进而获取渗透目标的权限, 此为*旁注*.

##### 域名查询IP
- http://ip.tool.chinaz.com
- https://ipchaxun.com
- https://site.ip138.com
获取端口信息或扫描等工作需要依赖已知的IP

##### C段存活主机探测
- https://github.com/se55i0n/Cwebscanner
查找与目标服务器IP处于同一个C段的服务器IP
```nmap
nmap -sP www.baidu.com/24
nmap -sP 192.168.1.*
```

##### CDN
Content Delivery Networ 内容分发网络, **将内容缓存在终端用户附近**, 依靠部署在各地的边缘服务器, 通过中心平台的负载均衡, 内容分发, 调度等功能模块, 使用户就近获取所需内容, 降低网络拥塞, 提高用户访问响应速度和命中率.
###### CDN判断
- 多地ping: 用多个地点ping同一个服务器, 查看对应IP是否唯一
	- http://ping.chinaz.com
	- http://www.webkaka.com/Ping.aspx
- 国外访问