## 什么是信息收集
信息收集是指通过各种方式获取所需要的信息, 方便后续渗透过程的进行. 比如目标站点IP, 中间件, 脚本语言, 端口, 邮箱等等. **信息收集包含资产收集但不限于资产收集**, 为了更多的暴露面和更大的可能性.

## 信息收集分类
- *主动信息收集*: 通过直接访问网站和在网站上进行操作, 对网站进行扫描等. 此种方法**有网络流量经过目标服务器**
- *被动信息收集*: 基于公开的渠道如搜索引擎, 在不与目标胸痛直接交互的情况下获取信息. 尽量避免留下痕迹.

## 收集哪些信息
- *域名信息* (whois, 备案信息, 子域名)
- *服务器信息* (端口, 服务, 真实IP)
- *网站信息* (网站架构, 操作系统, 中间件, 数据库, 编程语言, 指纹信息, WAF, 敏感目录, 敏感文件, 源码泄露, 旁站, C段)
- *管理员信息* (姓名, 职务, 生日, 联系电话, 邮件地址)

### 域名信息收集
域名 (Domain Name, 网域), 是由遗传用点分隔的名字组成的Internet上某一台计算机或计算机组的名称, 用于在数据传输时标识计算机的**逻辑位置**.

DNS (Domain Name System, 域名系统). 用来将*域名*和*IP地址*相互映射的一个分布式数据库

#### 域名分类
- 顶级域名 `.com`  `.gov`  `.edu`
- 二级域名 `baidu.com`
- 三级域名 `www.baidu.com`

#### Whois协议
是用来查询域名的IP以及所有者等信息的传输协议. whois就是一个用来查询域名是否已经被注册, 以及注册域名的详细信息的数据库 (如域名所有人, 域名注册商, 域名注册日期和过期日期等)
##### web接口查询
- https://whois.aliyun.com
- https://www.whois365.com/cn/
- http://whois.chanaz.com
##### 命令行查询
`whois baidu.com`
##### python脚本查询
```python
import whois

domain = input("Input the domain: ")
data = whois.whois(domain)
print("domain: %s" % data['domain_name'])
print("emails: %s" % data['emails'])
print("organisation: %s" % data['org'])
print("creation time: %s" % data['creation_time']
print("update time: %s" % data['updated_time'])
```

#### 备案信息
查询网站是否合法经营, 可以通过备案号反查该公司旗下的资产
- https://beian.miit.gov.cn
- http://www.beian.gov.cn/portal/registerSystemInfo
- http://icp.chanaz.com
- https://icplishi.com
- https://beianx.cn

#### Whois反查
通过注册人, 注册人邮箱, 注册人手机号等信息反查whois信息
很多公司网站都是DNS解析的运营商注册的, 查到的是云因伤代替个人何公司注册的网站信息
- https://whois.chinaz.com/reverse?ddlSearchMode=1
- http://whois.4.cn/reverse
- https://whois.aizhan.com
- https://whois.chinaz.com

#### 子域名
子域名指二级域名, `baidu.com`是顶级域名`.com`的子域
##### Google Hacking
https://www.exploit-db.com/google-hacking-database
- `intext:xxx` 正文中包含关键字的网页
- `intitle:xxx` 标题中含有关键字的网页
- `allintitle:xxx yyy` intitile指定多个词
- `site:xxx` url中含有关键字的网页
- `filetype:xxx` 指定文件类型
- `link:xxx` 包含指向指定连接的网页
- `related:xxx` 页面布局相似的网页
- `info:xxx` 返回xxx站点的指定信息
- `define:xxx` 返回xxx的定义
- `cache:xxx` 返回xxx网站的缓存
```
# 查找网站后台
site:xx.com intext:管理
site:xx.com inurl:login
```

###### Index of
查找允许目录浏览的web网站, 像在本地的普通目录
```
index of /admin
index of /passwd
"index of /" + passwd
"index of /" + password.txt
"index of /root"
```
- 未授权, 目录浏览漏洞
###### 子域名获取
`site:baidu.com`
###### Python脚本
Yijing.

##### 第三方web接口
- https://dnsdumpster.com
- https://www.dnsgrep.cn
- https://developers.virustotal.com/reference/domains-relationships
- http://tool.chinaz.com/subdomain
- https://phpinfo.me/domain
- https://www.nmmapper.com/sys/tools/subdomainfinder
##### 网络空间安全搜索引擎
- https://fofa.info 漏洞影响范围分析, 应用分布统计, 应用流行度排名统计
	- `domain="hetianlab.com"`
	- fofaviewer
- https://www.zoomeye.org 钟馗之眼, 启明星辰发布,通过后端的分布式爬虫引擎, 对每个节点的所有特征进行判别, 获得设备类型, 固件版本, 分布地点, 开放端口服务等信息
	- `domain="hetianlab.com"`
- https://hunter.qianxin.com 奇安信HUNTER: 资产探测, 端口探活, 协议解析, 应用识别.
	- `site"hetianlab.com"`
![[e9d16d413abb1e0fbc94df4ddeb9215.jpg]]
- https://www.shodan.io
	- `hostname:baidu.com`

#### SSL证书查询
- https://crt.sh
- https://developers.facebook.com/tools/ct/search

#### 滥用证书
- CTFR: https://github.com/UnaPibaGeek/crfr

#### DNS记录搜索子域
- https://github.com/guelfoweb/knock
- https://github.com/TheRook/subbrute

#### JS文件发现子域名
- https://github.com/Threezh1/JSFinder

#### 子域名收集工具
1. 子域名挖掘机
2. OneForAll https://github.com/shmilylty/OneForAll ***好使***
3. Subdomainsbrute 高并发DNS暴力枚举工具 https://github.com/lijiejie/subDomainBrute
4. Sublist3r https://github.com/aboul3la/Sublist3r
5. ESD https://github.com/FeeiCn/ESD
6. dnsbrute https://github.com/Q2h1Cg/dnsbrute
7. Anubis https://github.com/jonluca/Anubis
8. subdomain3 https://github.com/yanxiu0614/subdomain3
9. teemo https://github.com/bit4woo/teemo
10. Sudomy https://github.com/screetsec/Sudomy
11. ARL https://github.com/TophantTehnology/ARL
12. SubFinder + KSubdomain + HttpX (先安装winpcap)
	- **SubFinder**: 子域名信息查询工具, 使用国外安全网站的api自动化搜索
		- https://github.com/projectdiscovery/subfinder
	- **HttpX**: 运行速度极快的HTTP安全工具, 使用retryablehttp库和多线程机制
		- https://github.com/projectdiscovery/httpx
	- **ksubdomain**: 全平台无状态子域名DNS爆破工具, mac和win理论最快发包速度30w/s, linux160w/s
		- https://github.com/knownsec/ksubdomain
```linux
# 管道操作, 收集域名,验证域名,http验证存活
./subfinder -d baidu.com -silent|./ksubdomain -verify -silent|./https -title -content-length -status-code
```

### IP 端口信息收集
#### IP信息收集
##### IP反查域名
- http://stool.chinaz.com/same
- https://tools.ipip.net/ipdomain.php
- https://www.dnsgrip.cn
- https://site.ip138.com/
如果渗透目标为虚拟主机, 那么通过IP反查到的域名信息就很有价值. 一台物理服务器上可能运行多个虚拟主机. 这些虚拟主机有不同的域名, 但通常共用一个IP地址. 如果直到哪些网站共用这台服务器, 就有可能通过此台服务器上的其他网站的漏洞获取服务器控制权, 进而获取渗透目标的权限, 此为*旁注*.

##### 域名查询IP
- http://ip.tool.chinaz.com
- https://ipchaxun.com
- https://site.ip138.com
获取端口信息或扫描等工作需要依赖已知的IP

##### 旁站收集
- https://www.webscan.cc

##### C段存活主机探测
- https://github.com/se55i0n/Cwebscanner
- https://github.com/x0day/bannerscan
查找与目标服务器IP处于同一个C段的服务器IP
```nmap
nmap -sP www.baidu.com/24
nmap -sP 192.168.1.*
```

##### CDN
Content Delivery Networ 内容分发网络, **将内容缓存在终端用户附近**, 依靠部署在各地的边缘服务器, 通过中心平台的负载均衡, 内容分发, 调度等功能模块, 使用户就近获取所需内容, 降低网络拥塞, 提高用户访问响应速度和命中率.
###### CDN判断
- 多地ping: 用多个地点ping同一个服务器, 查看对应IP是否唯一
	- http://ping.chinaz.com
	- http://www.webkaka.com/Ping.aspx
- 国外访问: 有些网站设置的CDN可能没有包含国外访问, 所以可以绕过
	- https://ping.eu/ping/
###### CDN绕过
- 查询子域名IP: CDN流量收费高, 所以很多站长可能只对主站或流量大的子站做CDN, 而旁站小站子站一般于主站再统一服务器或C段内, 所以可以通过查询子域名的IP来辅助查找网站真实IP
	- https://ip.tool.chinaz.com/ipbatch
- MX记录邮件服务: 如果网站在与web相同的服务器和IP上托管自己的*邮件服务器*, 那么原始服务器IP将在MX记录中
- 查询历史DNS记录: 查看IP与域名绑定的历史记录, 可能或存在使用CDN前的记录
	- https://dnsdb.io/zh-cn/
	- https://securitytrails.com/
	- https://viewdns.info/iphistory/
	- https://www.ip138.com/
	- https://github.com/blechschmidt/massdns


##### DNS记录
- 域名注册完成后需要首先做*域名解析*, 即绑定域名与服务器所在IP, 由DNS服务器完成. 域名解析时会添加记录: https://developer.aliyun.com/article/331012
	- `SOA` 权威记录
	- `A` 指定主机名或域名对应的IPv4地址
	- `AAAA` IPv6地址记录
	- `PTR` IP地址反解析
	- `NS` 域名服务器记录, 指定该域名由哪个服务器解析
	- `MX` 邮件交换记录, 指向一个邮件服务器, 用于邮件系统发邮件时根据收信人的地址后缀来定位邮件服务器
	- `CNAME` 别名记录, 将多个名字映射到同一台计算机
	- `TXT` 某个主机名或域名的说明
- *泛域名*与*泛解析*: 
	- *泛域名*: 在一个域名根下, 以`*.domain.com`的形式表示这个域名跟所有为建立的子域名. 
	- *泛解析*: 将泛域名的A记录解析到某个IP地址上, 通过任意访问的前缀 `.domain.com`都能访问到你解析的站点上

#### 端口信息收集
在Internet上, 各主机间通过TCP/IP协议发送和接受数据包. 逻辑端口指用于区分服务的端口, 一般用于TCP/IP的端口, 范围0~65535, 0为保留. 物理端口则是集线器, 路由器, 交换机, ADSL Moderm等用于连接其它设备的端口.
##### 协议端口
- TCP端口: 面向连接的可靠的传输层通信协议, 发送消息后通过返回的应答确认消息是否到达
- UDP端口: 无连接的不可靠传输层协议, 不会确认信息是否到达
##### 端口类型
- 周知端口: `0-1023`
- 动态端口: `49152-65535` 一般不固定分配某种服务
- 注册端口: `1024-49151` 分配给用户进程或程序
##### 渗透端口
https://www.cnblogs.com/bmjoker/p/8833316.html

#### 常见端口
##### FTP 21
文件传输协议, 使用TCP端口, 20用于传输数据, 21用于传输控制信息
1. ftp基础爆破: owasp的Bruter, hydra以及msf的ftp爆破模块
2. ftp匿名访问: 用户名`anonymous` 密码为空或任意邮箱
3. fsvtpd后门: 2-2.3.4版本存在后门漏洞, 可获取root
	- https://www.freebuf.com/column/143480.html
4. 嗅探: ftp使用明文传输, 使用Cain渗透 (需要在局域网并欺骗网关)
5. ftp远程代码溢出
6. ftp跳转攻击
	- https://blog.csdn.net/mgxcool/article/details/48249473
7. ProFTPD 1.3.3c远程命令执行
	- https://blog.csdn.net/weixin_42214273/article/details/82892282

##### SSH 22
1. 弱口令, 使用工具hydra, msf中的ssh爆破模块
2. SSH后门: https://www.secpulse.com/archives/69093.html
3. openssh用户枚举 CVE-2018-15473: https://www.anquanke.com/post/id/157607

##### WWW(HTTP) 80
1. 中间件漏洞, 如IIS, apache, nginx等
2. 一般通过web应用程序的常见漏洞攻击

##### NetBIOS SessionService 139/445
139用于提供windows文件和打印机共享及UNIX的Samba服务
445用于提供windows文件和打印机共享
1. 对于开放139/445端口, 尝试利用MS17010溢出漏洞攻击(永恒之蓝)
2. 对于只开放445端口, 尝试利用MS06040, MS08067溢出漏洞攻击
3. 利用IPC$连接渗透

##### MySQL 3306
1. mysql弱口令破解, 上传构造的恶意UDF自定义函数代码, 调用函数
2. SQL注入获取数据库敏感信息, load_file()函数读取系统文件, 导出恶意代码到指定路径

##### RDP 3389
windows远程桌面服务默认监听端口
1. RDP暴力破解攻击
2. MS12_020死亡蓝屏攻击
3. RDP远程桌面漏洞 (CVE-2019-0708)
4. MSF开启RDP, 注册表开启RDP

##### Redis 6379
开源的可基于内存的可持久化的日志型数据库
1. 爆破弱口令
2. redis未授权访问结合ssh key提权
3. 主从复制rce
http://hetianlab.com/expc.do?ec=ECID9f92-ff93-4a94-a821-f0b968ef4985

##### Weblogic 7001
基于JAVAEE架构的中间件, 用于开发, 集成, 部署和管理大型分布式Web应用, 网络应用和数据库应用的Java应用服务器
1. 弱口令, 爆破, 弱密码一般为`weblogic/oracle@123`或`weblogic`
2. 管理后台部署 war包后门
3. weblogic SSRF
	- http://hetianlab.com/expc.do?ec=ECID9d6c0ca797abec2017021014312200001
4. 反序列化漏洞 
	- CNVD-C-2019-48814: https://www.hetianlab.com/expc.do?ec=ECID3f28-5c9a-4f95-999d-68fa2fa7b7aa
https://fuping.site/2017/06/05/Weblogic-Vulnerability-Verification

##### Tomcat-8080
1. 远程代码执行漏洞 CVE-2019-0232
	- https://www.hetianlab.com/expc.do?ec=ECIDefcf-3af2-438f-848f-8dc0f9e6b821
2. 任意文件上传 CVE-2017-12615
3. 管理页面弱口令getshell


#### 端口扫描 (NMAP)
Network Mapper 开源网络探测和安全审核工具 https://nmap.org/man/zh/
##### 端口状态
- open 端口开启, 数据有到达主机, 有程序在端口上监控
- closed 端口开启, 数据有到达主机, 没有程序在端口上监控
- filtered 数据没有到达主机, 返回的结果为空, 数据被防火墙或IDS过滤
- unfiltered 数据有到达主机, 但是不能识别端口的当前状态
- open|filtered 端口没有返回值, 主要在UDP, IP, FIN, NULL, Xmas扫描中
- closedfiltered 只发生在IP, ID idle扫描
常用参数参考 https://www.cnblogs.com/Vinson404/p/7784829.html
`nmap -v -Pn -p 6379 -sV xxx.xxx.xxx.xxx`
	- -v 显示过程
	- -Pn no ping
	- -p 指定端口
	- -sV 版本探测
##### 基础用法
```
nmap -A -T4 192.168.1.1

A：全面扫描\综合扫描
T4：扫描速度，共有6级，T0-T5

不加端口说明扫描默认端口，1-1024 + nmap-service

单一主机扫描：nmap 192.168.1.2
子网扫描：nmap 192.168.1.1/24
多主机扫描：nmap 192.168.1.1 192.168.1.10
主机范围扫描：nmap 192.168.1.1-100
IP地址列表扫描：nmap –iL target.txt

扫描除指定IP外的所有子网主机：
nmap 192.168.1.1/24 --exclude 192.168.1.1

扫描除文件中IP外的子网主机：
nmap 192.168.1.1/24 --excludefile xxx.txt

扫描特定主机上的80,21,23端口：
nmap –p 80,21,23 192.168.1.1
```
##### 扫描全部端口
```
nmap -sS -v -T4 -Pn -p 0-65535 -oN FullTCP -iL liveHosts.txt

• -sS：SYN扫描,又称为半开放扫描，它不打开一个完全的TCP连接，执行得很快，效率高（一个完整的tcp连接需要3次握手，而-sS选项不需要3次握手）

优点：Nmap发送SYN包到远程主机，但是它不会产生任何会话，目标主机几乎不会把连接记入系统日志。（防止对方判断为扫描攻击），扫描速度快，效率高，在工作中使用频率最高
缺点：它需要root/administrator权限执行

• -Pn：扫描之前不需要用ping命令，有些防火墙禁止ping命令。可以使用此选项进行扫描
• -iL：导入需要扫描的列表
```
##### 扫描常用端口及服务信息
```
nmap.exe -p445 -v --script smb-ghost 192.168.1.0/24
```
##### 其它端口扫描工具
- masscan https://github.com/rebertdavidgraham/masscan
- scanPort https://github.com/xs25cn/scanPort
- astsu https://github.com/Reddyyz/astsu
- http://coolaf.com/tool/port

### Github信息收集
在github上搜索有关企业, 单位的信息

### 网站信息收集
#### 操作系统

springboot越权