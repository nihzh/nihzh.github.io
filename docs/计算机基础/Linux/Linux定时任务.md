Linux通常使用*Crontab*设置周期性执行某一个shell脚本或Linux命令, 使用**cron表达式**设置任务周期, 称作*定时任务*

## Crontab

### 命令
1. 编辑/创建 `crontab -e` 存在则编辑, 不存在则创建
2. 查看当前所有任务 `crontab -l`
3. 删除当前所有任务 `crontab -r`
- 任务文件内容格式: 使用*cron表达式*, 与需要执行的命令或文件
	- `* * * * * <command>` 
	- 可以执行的命令参考[[1.3 命令执行|命令执行]], 最好是绝对路径
### 进程
cron进程是Linux中的守护进程, 在系统后台运行, crontab服务默认每隔一分钟读取一次*配置文件目录*下的所有内容, 同步任务
编辑crontab文件后系统会自动存放在`/var/spool/cron/`目录中
执行定时任务属主就是用户名自己, 即是在任务目录中文件名的名字
### 配置文件
- `/var/spool/cron/` 目录存放每个用户包括root的crontab任务, 每个任务以创建者的名字命名, **普通用户无法读取这个目录**, 必须使用crontab命令
- `/etc/crontab` 这个文件负责调度各种管理和维护任务(系统任务)
- `/etc/cron.d/` 目录存放任何要执行的crontab文件或脚本
- 还可以将脚本放在`/etc/cron.hourly/`, `/etc/cron.daily/`, `/etc/cron.weekly/`, `/etc/cron.monthly/`目录中, 每个小时/天/周/月执行一次, 使用run-parts参数默认调用

## cron表达式
cron表达式是一个字符串, 由6-7个字段组成, 用空格分隔. 其中前六个为必须, 最后一个为可选字段.
![[Pasted image 20230819014346.png]]
从左到右, 依次对每个字段指定相应的值, 就可以确定一个任务的执行时间和周期, 值可以由数字配合字符组成.

### cron字符
- `*` 通配符, 代表所有可能的值
- `-` 指定范围, `1-10`在秒字段中代表一分钟中的第1至第10秒
- `,` 指定值, `2,4,5`在分钟字段代表一小时中的第2, 第4和第5分钟
- `/` 指定起始值和跳步数, `3/5`代表`3,8,13`, 在小时字段也就是一天中的第3小时开始, 每5小时生效一次
- `?` **仅用于"日"和"周"字段**, 这两个字段会发生冲突, 所以当指定某一个值时, 用?表示不生效的字段
- `SUN` **仅用于"周"字段**, 星期日, 也可以用数字0或7代替, 其余day也可以用简称或数字代替
- `L` Last, **仅用于"日"和"周"字段**
	- 日字段: 每个月的最后一天, 可以使用偏移量`l-1`即当月倒数第二天
	- 周字段: 每个周的最后一天, 等效`7`或`SUN`. 但`7L`则代表当月最后一个周日


## References
1. [简洁明了看懂cron表达式 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/437328366)